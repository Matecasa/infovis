<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>TP · Presentación de Gráficos</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
<style>
  :root{
    --bg:#f7f9fc; --card:#fff; --text:#0f172a; --muted:#475569; --border:#e5e7eb;
    --accent:#4f46e5; --radius:16px; --gap:18px; --shadow:0 10px 28px rgba(15,23,42,.09);
  }
  *{box-sizing:border-box}
  body{margin:0;background:var(--bg);color:var(--text);font-family:Inter,system-ui,Arial,sans-serif;line-height:1.55}
  header{padding:36px 16px 8px;text-align:center}
  h1{margin:0 0 6px;font-size:clamp(28px,4.5vw,44px);letter-spacing:-.02em}
  p.lead{margin:0 auto 8px;max-width:900px;color:var(--muted)}
  main{max-width:1200px;margin:18px auto 42px;padding:0 16px}
  .grid{display:grid;gap:22px;grid-template-columns:1fr}
  @media(min-width:990px){ .grid{grid-template-columns:repeat(2,1fr)} }
  .card{
    background:var(--card);border:1px solid var(--border);border-radius:var(--radius);
    box-shadow:var(--shadow);padding:14px;display:flex;flex-direction:column;gap:10px;min-height:420px
  }
  .card h2{margin:4px 6px 0;font-size:18px}
  .toolbar{display:flex;gap:8px;flex-wrap:wrap;margin:0 6px}
  .btn{
    padding:9px 12px;border:1px solid var(--border);border-radius:10px;background:#fff;color:var(--text);
    cursor:pointer;font-weight:600
  }
  .btn:hover{outline:2px solid #e0e7ff}
  .embed{position:relative;border:1px solid var(--border);border-radius:12px;overflow:hidden;background:#fff;flex:1}
  .embed .inner{position:absolute;inset:0}
  .ratio-16x9{padding-top:56.25%}
  .ratio-3x2{padding-top:66.66%}
  .ratio-auto{padding-top:0;min-height:160px}
  .embed iframe{position:absolute;inset:0;width:100%;height:100%;border:0;display:block}

  /* RAWGraphs */
  .raw-stage{position:relative;overflow:auto;display:flex;justify-content:center;align-items:flex-start;padding:12px;min-height:360px}
  .raw-holder{transform-origin:0 0; display:inline-block}
  /* que el SVG escale al ancho del contenedor */
  #rawsvg{max-width:100%;height:auto;display:block}
  .hint{color:var(--muted);font-size:13px;margin:6px 6px 0}
  footer{color:var(--muted);text-align:center;padding:22px 16px 36px;font-size:13px}
</style>
</head>
<body>
  <header>
    <h1>Trabajo Práctico · Presentación</h1>
    <p class="lead">Todas las visualizaciones en una sola pantalla. Fondo claro para buena legibilidad.</p>
  </header>

  <main>
    <section class="grid">
      <!-- Flourish -->
      <article class="card" id="card-flourish">
        <h2>Flourish · Jerarquía</h2>
        <div class="toolbar">
          <button class="btn" data-fs="#card-flourish">Pantalla completa</button>
          <a class="btn" href="https://public.flourish.studio/visualisation/25147256/" target="_blank" rel="noopener">Abrir en Flourish</a>
        </div>
        <div class="embed ratio-3x2"><div class="inner">
          <div class="flourish-embed flourish-hierarchy" data-src="visualisation/25147256"></div>
        </div></div>
      </article>

      <!-- RAWGraphs (SVG inline) -->
      <article class="card" id="card-raw">
        <h2>RAWGraphs · Diagrama (SVG)</h2>
        <div class="toolbar">
          <button class="btn" data-fs="#card-raw">Pantalla completa</button>
          <label class="btn">Zoom
            <input id="rawZoom" type="range" min="50" max="200" value="100" style="vertical-align:middle;margin-left:6px">
          </label>
          <button class="btn" id="rawFit">Ajustar al ancho</button>
          <button class="btn" id="rawReset">Reset</button>
          <button class="btn" id="rawPng">Descargar PNG</button>
          <button class="btn" id="rawSvg">Descargar SVG</button>
        </div>
        <div class="embed raw-stage">
          <div class="raw-holder" id="rawHolder">
            <!-- ========= REEMPLAZÁ ESTE <svg id="rawsvg"> POR TU SVG DE RAWGRAPHS ========= -->
            <svg id="rawsvg" viewBox="0 0 600 360" xmlns="http://www.w3.org/2000/svg" aria-label="RAWGraphs">
              <rect width="100%" height="100%" fill="#ffffff"/>
              <text x="50%" y="50%" text-anchor="middle" dominant-baseline="middle"
                    font-family="Inter, Arial, sans-serif" font-size="18" fill="#64748b">
                Pegá tu SVG de RAWGraphs aquí (reemplazá este bloque)
              </text>
            </svg>
            <!-- =============================== FIN REEMPLAZO =============================== -->
          </div>
        </div>
        <p class="hint">Si se veía “cortado”, este archivo lo corrige automáticamente (viewBox y escalado).</p>
      </article>

      <!-- Datawrapper -->
      <article class="card" id="card-dw">
        <h2>Datawrapper · Gastos</h2>
        <div class="toolbar">
          <button class="btn" data-fs="#card-dw">Pantalla completa</button>
        </div>
        <div class="embed ratio-auto"><div class="inner">
          <iframe title="Gastos totales" aria-label="Bar Chart" id="datawrapper-chart-Ad1jv"
                  src="https://datawrapper.dwcdn.net/Ad1jv/1/" scrolling="no"></iframe>
        </div></div>
      </article>

      <!-- Power BI -->
      <article class="card" id="card-pbi">
        <h2>Power BI · Dashboard</h2>
        <div class="toolbar">
          <button class="btn" data-fs="#card-pbi">Pantalla completa</button>
        </div>
        <div class="embed ratio-16x9"><div class="inner">
          <iframe title="TP"
                  src="https://app.powerbi.com/view?r=eyJrIjoiMmZkNDI4NTktMmU2YS00ZjcxLTgyMDItNmQ0YTQzNTY1OGNkIiwidCI6ImExZjUwYTk3LTIxYzAtNDlhNy1hOWQ0LWYyNDRlYmI0MmRhNyIsImMiOjR9"
                  allowfullscreen></iframe>
        </div></div>
      </article>
    </section>
  </main>

  <footer>© 2025 • InfoVis • GitHub Pages</footer>

  <!-- Scripts de proveedores -->
  <script src="https://public.flourish.studio/resources/embed.js" defer></script>

  <!-- Fullscreen por tarjeta -->
  <script>
    document.querySelectorAll('[data-fs]').forEach(btn=>{
      btn.addEventListener('click',()=>{
        const sel = btn.getAttribute('data-fs');
        const el = document.querySelector(sel);
        if (el && el.requestFullscreen) el.requestFullscreen();
      });
    });
  </script>

  <!-- Auto-resize Datawrapper -->
  <script>
    (function(){
      "use strict";
      window.addEventListener("message", function(e){
        if (e.data["datawrapper-height"] !== undefined) {
          var iframes = document.querySelectorAll("iframe");
          for (var id in e.data["datawrapper-height"]) {
            for (var i=0;i<iframes.length;i++){
              if (iframes[i].contentWindow === e.source) {
                iframes[i].style.height = e.data["datawrapper-height"][id] + "px";
              }
            }
          }
        }
      });
    })();
  </script>

  <!-- FIX RAWGRAPHS: viewBox, escalado, fit, export -->
  <script>
    (function(){
      const holder = document.getElementById('rawHolder');
      const zoom   = document.getElementById('rawZoom');
      const reset  = document.getElementById('rawReset');
      const fitBtn = document.getElementById('rawFit');
      const btnPNG = document.getElementById('rawPng');
      const btnSVG = document.getElementById('rawSvg');

      // Aplica zoom (escala el contenedor del SVG)
      const applyZoom = v => holder.style.transform = `scale(${v/100})`;

      // Asegura que el SVG sea responsive y que no quede "cortado"
      function makeResponsive(svg){
        if (!svg) return;

        // 1) Si NO hay viewBox, lo creamos a partir de width/height
        if (!svg.getAttribute('viewBox')) {
          const w = parseFloat(svg.getAttribute('width'))  || 1600;
          const h = parseFloat(svg.getAttribute('height')) || 900;
          svg.setAttribute('viewBox', `0 0 ${w} ${h}`);
        }

        // 2) Quitamos width/height fijos para permitir escalar
        svg.removeAttribute('width');
        svg.removeAttribute('height');

        // 3) Ajustamos el viewBox a lo que realmente ocupa el contenido (BBox)
        //    Esto corrige cuando el gráfico quedó desplazado/recortado.
        try {
          const bbox = svg.getBBox(); // puede fallar si el SVG está vacío
          if (bbox && isFinite(bbox.width) && bbox.width > 0 && isFinite(bbox.height) && bbox.height > 0) {
            const pad = Math.max(bbox.width, bbox.height) * 0.02; // 2% de margen
            const vb = [bbox.x - pad, bbox.y - pad, bbox.width + 2*pad, bbox.height + 2*pad];
            svg.setAttribute('viewBox', vb.join(' '));
          }
        } catch(e) { /* si falla getBBox, dejamos el viewBox anterior */ }

        svg.setAttribute('preserveAspectRatio','xMidYMid meet');
        // que ocupe el ancho del contenedor
        svg.style.maxWidth = '100%';
        svg.style.height = 'auto';
        svg.style.display = 'block';
      }

      // Ajustar el SVG al ancho del contenedor visible (sin scroll horizontal)
      function fitToWidth(){
        // reset zoom y centra
        zoom.value = 100; applyZoom(100);
        // nada más: el viewBox + max-width ya se ocupan del ajuste
        // dejamos esta acción para que el usuario "vuelva" fácilmente
      }

      function init(){
        const svg = document.getElementById('rawsvg');
        if (!svg) return;
        makeResponsive(svg);
        applyZoom(+zoom.value);
      }

      // Eventos
      zoom.addEventListener('input', e=> applyZoom(+e.target.value));
      reset.addEventListener('click', ()=> { zoom.value=100; applyZoom(100); });
      fitBtn.addEventListener('click', fitToWidth);

      // Exportar SVG
      btnSVG.addEventListener('click', ()=>{
        const svg = document.getElementById('rawsvg');
        if (!svg) { alert('Pegá tu SVG (root con id="rawsvg")'); return; }
        const xml = new XMLSerializer().serializeToString(svg);
        const blob = new Blob([xml], {type:"image/svg+xml;charset=utf-8"});
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url; a.download = 'rawgraphs.svg'; a.click();
        URL.revokeObjectURL(url);
      });

      // Exportar PNG
      btnPNG.addEventListener('click', ()=>{
        const svg = document.getElementById('rawsvg');
        if (!svg) { alert('Pegá tu SVG (root con id="rawsvg")'); return; }
        const xml = new XMLSerializer().serializeToString(svg);
        const img = new Image();
        img.onload = function(){
          // usa el viewBox actual
          const vb = (svg.getAttribute('viewBox') || '0 0 1600 900').split(/\s+/).map(Number);
          const w = Math.max(1, Math.round(vb[2] || 1600));
          const h = Math.max(1, Math.round(vb[3] || 900));
          const canvas = document.createElement('canvas');
          canvas.width = w; canvas.height = h;
          const ctx = canvas.getContext('2d');
          ctx.fillStyle = '#ffffff';
          ctx.fillRect(0,0,w,h);
          ctx.drawImage(img, 0, 0, w, h);
          const a = document.createElement('a');
          a.download = 'rawgraphs.png';
          a.href = canvas.toDataURL('image/png');
          a.click();
        };
        img.onerror = ()=> alert('No se pudo convertir el SVG. Verificá que esté pegado correctamente.');
        img.src = 'data:image/svg+xml;charset=utf-8,' + encodeURIComponent(xml);
      });

      // Inicializar cuando el DOM esté listo
      window.addEventListener('DOMContentLoaded', init);
    })();
  </script>
</body>
</html>


